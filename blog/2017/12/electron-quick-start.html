<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
     Electron 快速入门 - 沉默的大树 
  </title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="shortcut icon" href="/img/favicon.png" type="image/x-icon">
</head>

<body>
  <div id="layout">
    <a href="#menu" id="menuLink" class="menu-link">
      <span></span>
    </a>
    <div id="menu">
      <a class="pure-menu-header" href="https://cmdtree.com">沉默的大树</a>
      <div class="pure-menu">
        <ul class="pure-menu-list">
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com">
              Home</a>
          </li>
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="/about.html">
              </i>About</a>
          </li>
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="/contact.html">
              </i>Contact</a>
          </li>
          <!--
              <li class="pure-menu-item">
                <a class="pure-menu-link" href="https://cmdtree.com/index.xml">
                  <i class="fa fa-rss fa-fw"></i>RSS</a>
              </li> -->
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://github.com/rhatyang" target="_blank">
              </i>GitHub</a>
          </li>
        </ul>
        <ul class="pure-menu-list category-list">
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/network.html">网络技术与安全
              <span>(9)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/use.html">使用笔记
              <span>(47)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/learn.html">学习笔记
              <span>(29)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/history.html">历史爱好者
              <span>(3)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/lifetime.html">晃眼一生
              <span>(17)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/linux.html">Unix/Linux
              <span>(15)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/javascript.html">JavaScript
              <span>(36)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/other.html">杂文
              <span>(5)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/review.html">观后感
              <span>(2)</span>
            </a>
          </li>
          
          <li class="pure-menu-item">
            <a class="pure-menu-link" href="https://cmdtree.com/blog/python.html">Python
              <span>(2)</span>
            </a>
          </li>
          
        </ul>
      </div>
      <div class="menu-footer">
        <div class="small-print copyright">
          © 2018. All rights reserved.
        </div>
        <div class="small-print powered">
          Powered by Node.js. Open Source on
          <a href="https://github.com/rhatyang/cmdtree" target="_blank">Github</a>.
        </div>
        <div class="small-print">
          所有内容根据
          <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank">CC BY 4.0</a>
          协议进行开源
        </div>
        <div class="last-updated small-print">
          最后一次更新在：2018年3月4日
        </div>
      </div>
    </div>
    <div id="main">
      
<article class="content page" itemscope itemtype="http://schema.org/Blogpageing">
  <div class="page-header">
    <h1 class="page-title">Electron 快速入门</h1>
    <div class="page-meta">
      <p><time datetime="2017-12-18" itemprop="datePublished">日期：2017年12月18日</time></p>
      <span class="post-category">分类：学习笔记</span>
    </div>
  </div>
  <div class="page-content" itemprop="articleBody">
    <p>Electron是一种基于Node.js的跨平台技术，可以用HTML、CSS、JS来构建桌面应用。</p>
<h2>前提条件</h2>
<ul>
<li>最新稳定版的Node.js</li>
<li>Electron (<code>npm i electron -g</code>)</li>
</ul>
<h2>快速开始</h2>
<p>首先，把官方的一个快速开始的例子克隆下来：</p>
<pre><code class="hljs">git clone https://github.com/electron/electron-quick-start.git
</code></pre>
<p>然后使用NPM或者YARN安装好依赖（本步骤可省略，因为这个例子仅有一个electron包需要安装）</p>
<pre><code class="hljs">npm install
</code></pre>
<p>接着就可以运行程序了</p>
<pre><code class="hljs">npm start    ## 或者 electron .
</code></pre>
<p>接着就会弹出一个窗口，就是这个快速开始的程序</p>
<p><img src="/pics/2017/12/1801.png" alt=""></p>
<h2>解析文件</h2>
<p>可以运行了以后再来看一下这个程序里面都包括哪些文件</p>
<p><img src="/pics/2017/12/1802.png" alt=""></p>
<p>忽略其它无关文件和没有内容的<code>renderer.js</code>，我们需要关注下面三个文件</p>
<pre><code class="hljs">electron-quick-start/
  ├── package.json
  ├── main.js
  └── index.html
</code></pre>
<p>首先是<code>package.json</code>，这是Nodejs项目的配置文件，里面包括了这个项目的一些信息和一些依赖情况，这个我们都知道。</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"electron-quick-start"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A minimal Electron application"</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"main.js"</span>,
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"start"</span>: <span class="hljs-string">"electron ."</span>
  },
  <span class="hljs-attr">"repository"</span>: <span class="hljs-string">"https://github.com/electron/electron-quick-start"</span>,
  <span class="hljs-attr">"keywords"</span>: [
    <span class="hljs-string">"Electron"</span>,
    <span class="hljs-string">"quick"</span>,
    <span class="hljs-string">"start"</span>,
    <span class="hljs-string">"tutorial"</span>,
    <span class="hljs-string">"demo"</span>
  ],
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"GitHub"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"CC0-1.0"</span>,
  <span class="hljs-attr">"devDependencies"</span>: {
    <span class="hljs-attr">"electron"</span>: <span class="hljs-string">"~1.7.8"</span>
  }
}
</code></pre>
<p>这里需要注意的一点是<code>main</code>字段定义了这个项目的入口文件，它指向<code>main.js</code>。</p>
<h2>main.js</h2>
<p>这个文件是项目的入口文件，来看看它里面写了什么</p>
<pre><code class="hljs js"><span class="hljs-keyword">const</span> electron = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>)
<span class="hljs-keyword">const</span> app = electron.app
<span class="hljs-keyword">const</span> BrowserWindow = electron.BrowserWindow

<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>)

<span class="hljs-keyword">let</span> mainWindow

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createWindow</span> (<span class="hljs-params"></span>) </span>{

  mainWindow = <span class="hljs-keyword">new</span> BrowserWindow({<span class="hljs-attr">width</span>: <span class="hljs-number">800</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>})

  mainWindow.loadURL(url.format({
    <span class="hljs-attr">pathname</span>: path.join(__dirname, <span class="hljs-string">'index.html'</span>),
    <span class="hljs-attr">protocol</span>: <span class="hljs-string">'file:'</span>,
    <span class="hljs-attr">slashes</span>: <span class="hljs-literal">true</span>
  }))

  mainWindow.on(<span class="hljs-string">'closed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    mainWindow = <span class="hljs-literal">null</span>
  })
}

app.on(<span class="hljs-string">'ready'</span>, createWindow)

app.on(<span class="hljs-string">'window-all-closed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (process.platform !== <span class="hljs-string">'darwin'</span>) {
    app.quit()
  }
})

app.on(<span class="hljs-string">'activate'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (mainWindow === <span class="hljs-literal">null</span>) {
    createWindow()
  }
})
</code></pre>
<h3>createWindow()</h3>
<p>上面各种导入声明不看，关键看<code>createWindow()</code>函数，我们来一步一步的分析</p>
<pre><code class="hljs js">mainWindow = <span class="hljs-keyword">new</span> BrowserWindow({<span class="hljs-attr">width</span>: <span class="hljs-number">800</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>})
</code></pre>
<p><code>BrowserWindow</code>是一个是用来创建窗口的模块，是主进程，接受一个参数<code>[options]</code>。上面的例子中width为创建窗口的宽度，height为高度，表示打开一个长600px、宽800px的窗口。这里可以接受的参数很多，可以查看文档<a href="https://electronjs.org/docs/api/browser-window#new-browserwindowoptions">BrowserWindow#new-browserwindowoptions</a></p>
<p>接着出现<code>loadURL</code>方法为主窗口载入一个页面，作为程序打开的首页。</p>
<pre><code class="hljs js">mainWindow.loadURL(url.format({
    <span class="hljs-attr">pathname</span>: path.join(__dirname, <span class="hljs-string">'index.html'</span>),
    <span class="hljs-attr">protocol</span>: <span class="hljs-string">'file:'</span>,
    <span class="hljs-attr">slashes</span>: <span class="hljs-literal">true</span>
  }))
</code></pre>
<p>这里使用了Nodejs的<a href="https://nodejs.org/api/url.html#url_url_format_urlobject">url.format</a>方法间接的传入了<code>./index.html</code>文件作为首页，或者也可以直接在这里写一个URL:</p>
<pre><code class="hljs js">mainWindow.loadURL(<span class="hljs-string">'https://fanzhiyang.com'</span>);
</code></pre>
<p>接着来看一下index.html文件</p>
<pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    We are using Node.js <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-built_in">document</span>.write(process.versions.node)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>,
    Chromium <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-built_in">document</span>.write(process.versions.chrome)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>,
    and Electron <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-built_in">document</span>.write(process.versions.electron)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>.

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-built_in">require</span>(<span class="hljs-string">'./renderer.js'</span>)
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<p>没错，这就是刚才看到的程序了，其实就是个HTML页面。<code>process.versions.node</code>、<code>process.versions.chrome</code>、<code>process.versions.electron</code>分别是node版本、Chrome内核版本和electron的版本。</p>
<p>在<code>createWindow()</code>函数最后的是关闭窗口的函数。</p>
<pre><code class="hljs js">mainWindow.on(<span class="hljs-string">'closed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    mainWindow = <span class="hljs-literal">null</span>
})
</code></pre>
<p>直接将<code>null</code>赋给mainWindow就好了。</p>
<p>看到这里，你也许会这样想，其实Electron就是一个“浏览器”罢了，对，没错，你完全可以这样理解，你可以按照编写WEB页面的方式来写这个程序，只是不同的是，这个浏览器就是chromium内核，你无需考虑任何兼容性问题，并且你可以使用各种Node API，以及支持各种新特性。</p>
<h3>app</h3>
<p>app控制了整个程序的生命周期，来看看上面代码中触发的一些事件。</p>
<pre><code class="hljs js">app.on(<span class="hljs-string">'ready'</span>, createWindow)
</code></pre>
<p><code>ready</code>，当electron完成初始化的时候触发，就是上面提到的<code>createWindow()</code>。</p>
<pre><code class="hljs js">app.on(<span class="hljs-string">'window-all-closed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (process.platform !== <span class="hljs-string">'darwin'</span>) {
    app.quit()
  }
})
</code></pre>
<p><code>window-all-closed</code>，当所有的窗口都被关闭时触发，调用<code>quit()</code>方法退出应用。</p>
<pre><code class="hljs js">app.on(<span class="hljs-string">'activate'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (mainWindow === <span class="hljs-literal">null</span>) {
    createWindow()
  }
})
</code></pre>
<p>以及一个只有在mac OS里面才会被触发的<code>activate</code>事件，应该是在从dock中打开这个程序时重新加载窗口吧。</p>
<h2>开发者工具</h2>
<p>既然刚才说到开发人员可以像开发WEB应用一样去开发Electron，那怎能少得了浏览器中的开发者工具呢</p>
<pre><code class="hljs js">mainWindow.webContents.openDevTools();
</code></pre>
<p>只要在<code>createWindow()</code>函数中加入上面的代码，就会自动打开开发者工具，像这样</p>
<p><img src="/pics/2017/12/1803.png" alt=""></p>
<h2>结束</h2>
<p>其实这个东西我也只是之前听说过一点，Atom就是使用Electron开发的，类似的还有Github Desktop、VScode等都是基于Electron开发的。</p>

  </div>
</article>

    </div>
  </div>
  <script src="/js/ui.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-113894191-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-113894191-1');

  </script>
</body>

</html>
